"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8016],{87294:(e,t,a)=>{a.r(t),a.d(t,{MessageStoreDebugChart:()=>S});var n=a(77094),i=a.n(n),s=a(50953),o=a(92667),r=a(68414),u=a(98649),d=a(93382),l=a(42816),c=a(96486),g=a.n(c),p=a(67294),h=a(63143),m=a(75233),b=a(79420),v=a(73110);const w=300,f=1*h.C0,M={...d.j,fontSize:"10px",background:"black",border:"1px solid white",color:"white"},k={fontSize:"10px"};function x(e,t,a){const n=e.slice();return n.push(t),n.length>a&&n.splice(0,n.length-a),n}function S(e){window.__c="MessageStoreDebugChart";const{width:t,height:a}=e,[n,s]=(0,p.useState)({subscriptions:[],queueSize:[],pendingUnsubscribes:[],pendingEvictions:[]}),o=(0,p.useMemo)((()=>[{pluralName:"subscriptions",stroke:"white",fill:"black",data:n.subscriptions},{pluralName:"queued requests",stroke:"yellow",fill:"transparent",data:n.queueSize},{pluralName:"pending unsubscribes",stroke:"springgreen",fill:"transparent",data:n.pendingUnsubscribes},{pluralName:"pending evictions",stroke:"lightgray",fill:"transparent",data:n.pendingEvictions}]),[n]);return(0,p.useEffect)((()=>{const e=window.setTimeout((()=>{const e=(0,v.Tm)(),t=(0,v.EM)(),a=b.Z.getPendingUnsubscribeCount(),i=m.Z.getPendingEvictionCount();s({subscriptions:x(n.subscriptions,e._total,w),queueSize:x(n.queueSize,t.queue,w),pendingUnsubscribes:x(n.pendingUnsubscribes,a,w),pendingEvictions:x(n.pendingEvictions,i,w)})}),f);return()=>window.clearTimeout(e)}),[n]),i()(y,{width:t,height:a,dataStreams:o,maxDataLength:w,baseMaxDataValue:500,dataPointIntervalMs:f})}function y(e){window.__c="RealtimeVisualization";const{width:t,height:a,dataStreams:n,maxDataLength:d,baseMaxDataValue:c,dataPointIntervalMs:m}=e,[b,v]=(0,p.useState)(),w=(0,p.useMemo)((()=>Math.max(c,...g().flatten(n.map((e=>e.data))))),[n,c]),f=(0,p.useMemo)((()=>(0,o.Z)({range:[a,0],domain:[0,w],nice:!0})),[a,w]),x=(0,p.useMemo)((()=>(0,o.Z)({range:[0,t],domain:[0,d-1],nice:!0})),[t,d]),S=(0,p.useCallback)((()=>v(void 0)),[]),y=(0,p.useCallback)((e=>{const{x:t}=(0,s.Z)(e)||{x:0},a=Math.round(x.invert(t)),i=n[0].data.length;if(a>=i)return void v(void 0);const o=n[0][a],r=f(o),u=Date.now()-(i-1-a)*m;v({x:t,y:r,dataStreamIndex:a,timestamp:u})}),[x,n,f,m]);return i()("div",{},void 0,i()("svg",{width:t,height:a},void 0,n.map(((e,t)=>i()(r.Z,{data:e.data,x:(e,t)=>x(t),y:e=>f(e),strokeWidth:1,stroke:e.stroke,fill:e.fill,yScale:f},t))),i()(u.Z,{x:0,y:0,width:t,height:a,fill:"transparent",onMouseMove:y,onMouseLeave:S})),b&&i()("div",{},void 0,i()(l.Z,{top:b.y,left:b.x,style:M},Math.random(),i()("div",{style:{color:"darkgray"}},void 0,function(e){const t=Date.now()-e;return t<h.C0?"just now":t<h.hM?`${Math.round(t/h.C0)} seconds ago`:`${(t/h.hM).toFixed(1)} minutes ago`}(b.timestamp)),n.map(((e,t)=>i()("div",{style:{color:e.stroke}},t,e.data[b.dataStreamIndex]," ",e.pluralName))))),i()("div",{style:k},void 0,n.map(((e,t)=>i()("div",{style:{color:e.stroke}},t,0===e.data.length?"0":e.data[e.data.length-1]," ",e.pluralName)))))}}}]);